<!DOCTYPE html><html lang="en" data-astro-transition-scope="astro-smooz4hq-1"> <head><meta charset="utf-8"><meta name="description" content="Astro description"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" href="https://fonts.googleapis.com/css2?family=Josefin+Sans&family=Pacifico&display=swap" as="style"><link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&family=Pacifico&display=swap" rel="stylesheet"><meta name="generator" content="Astro v4.16.7"><title>Rug Racers: Ultimate</title><style>#themeToggle[data-astro-cid-oemx5le4]{border:0;background:none}#themeToggle[data-astro-cid-oemx5le4]:hover{cursor:pointer;rotate:10deg}.moon[data-astro-cid-oemx5le4]{fill:#fdebf3}.sun[data-astro-cid-oemx5le4],.light .moon[data-astro-cid-oemx5le4]{fill:transparent}.light .sun[data-astro-cid-oemx5le4]{fill:#1e1e2e}@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0;mix-blend-mode:plus-lighter}to{opacity:1;mix-blend-mode:plus-lighter}}@keyframes astroFadeOut{0%{opacity:1;mix-blend-mode:plus-lighter}to{opacity:0;mix-blend-mode:plus-lighter}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
:root{--background: #1e1e2e;--background-light: #ffffff;--button: #78c2ad;--text: #fff7f7;--text-light: #2e2a1e;--text-link: #78c2ad;--underline: #375a7f;--header: "Cambria";--body: "Josefin Sans", sans-serif}html{background-color:var(--background);color:var(--text)}body{max-width:780px;margin:0 auto;text-align:justify}h1,h2{font-family:var(--header);font-weight:400}h1{font-size:2.6rem;margin:0 0 5px}h2{text-decoration:underline var(--underline);text-decoration-thickness:4px;text-underline-offset:7px;font-size:2.1rem;margin-bottom:0}p{font-family:var(--body);font-size:1.1rem;hyphens:None;line-height:1.5;text-indent:1rem}small,li{font-family:var(--body)}.navbar{display:grid;grid-template-columns:1fr 1fr;margin-top:.8rem}.navbar__title{font-family:var(--header);font-size:1.3rem}.navbar__menu{font-family:var(--body);font-size:1.1rem;text-align:right}.navbar__title>a,.navbar__menu>a{color:var(--text);text-decoration:none}.navbar__menu>a{margin:0 10px}.navbar__title>a:hover,.navbar__menu>a:hover,.navbar__menu>a:focus{text-decoration:underline var(--underline);text-decoration-thickness:2px;text-underline-offset:6px}.gif{margin:20px 0 0;text-align:center}.badge{background-color:#584966;color:var(--text);border-radius:6px;font-family:var(--body);font-weight:600;font-size:.85rem;padding:.3em .6em .2em}.badge__list{text-indent:1rem;list-style:none;padding:0}.badge__list>li{margin-top:10px}.badge--item{border-radius:4px;font-size:.7rem;margin-right:5px;padding:.5em .3em .3em}.badge__link{color:var(--text-link);text-decoration:none}.badge__link:hover{text-decoration:underline}.card{list-style:none;display:flex;background-size:400%;padding:20px}.card__link{width:100%;text-decoration:none;line-height:1.4;border-radius:8px;color:var(--text)}.card__img{border-radius:5px}.card__title{margin:0;font-family:var(--body);font-size:1.5rem;font-weight:400;text-align:left}.card__txt{font-size:1rem;line-height:1.5;text-indent:0;text-align:left;margin:.5rem 0 0}.card__link:hover{transform:scale(1.05)}.link-card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(50ch,1fr));gap:1rem;padding:0}.btn{text-align:center;background:#0000;border:2px solid var(--button);border-radius:8px;color:var(--text);font:600 16px var(--body);padding:8px 16px;transition:background-color .4s,color .4s}.btn:hover{background-color:var(--button);color:var(--text-light);cursor:pointer}.skills{margin-top:8px}.skills__img{margin:8px 4px}.center{text-align:center}.pro-img{border-radius:16px;margin-top:10px}footer{margin:4rem 0}.footer__link{color:var(--text-link);text-decoration:none}.footer{cursor:default;list-style:none;padding:0}.icon__btn{display:inline-block;padding:0 .5rem}.icon__link{display:flex;padding:10px;height:20px;width:20px;border-radius:50%;border:2px solid #fdebf3}.icon__link:hover{border-color:var(--text-link)}.git-icon{content:url(/github-mark-white.svg)}.mail-icon{content:url(/mail-white.svg)}.linked-in{content:url(/li-in-white.png)}.lost{margin-top:30%;text-align:center}.lost__header{margin:0 auto;text-align:center;border:0;font-size:7.5rem;letter-spacing:10px}.lost__body{color:#5c5b77}.lost__link{color:var(--text-link);text-decoration:none}html.light{background-color:var(--background-light);color:var(--text-light)}.light .navbar__title>a{color:var(--text-light)}.light .navbar__menu>a{color:var(--text-light)}.light .card__title,.light .card__txt,.light .btn{color:var(--text-light)}.light .btn:hover{color:var(--text)}.light .icon__link{border:2px solid var(--text-light)}.light .icon__link:hover{border-color:var(--text-link)}.light .git-icon{content:url(/github-mark.svg)}.light .mail-icon{content:url(/mail.svg)}.light .linked-in{content:url(/li-in.png)}.light .badge__link{color:var(--text-link)}@media only screen and (max-width: 600px){body{width:350px}.navbar{display:initial}.navbar__title,.navbar__menu{text-align:center}.navbar__menu>a{margin:0 11px}.skills__img{height:30px;width:30px;margin:8px 1px}.badge__list{font-size:.9rem;text-indent:0}.pro-img{height:auto;width:350px}}
</style><script type="module">function e(){localStorage.theme==="light"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: light)").matches?document.documentElement.classList.add("light"):document.documentElement.classList.remove("light")}e();document.addEventListener("astro:after-swap",e);
</script><style>[data-astro-transition-scope="astro-smooz4hq-1"] { view-transition-name: astro-smooz4hq-1; }@layer astro { ::view-transition-old(astro-smooz4hq-1) { animation: none; opacity: 0; mix-blend-mode: normal; }::view-transition-new(astro-smooz4hq-1) { animation: none; mix-blend-mode: normal; }::view-transition-group(astro-smooz4hq-1) { animation: none } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-smooz4hq-1"] { animation: none; mix-blend-mode: normal; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-smooz4hq-1"] { animation: none; mix-blend-mode: normal; }</style></head> <body> <header> <nav data-astro-transition-persist="astro-c3mo5b3h-2"> <div class="navbar"> <div class="navbar__title"></div> <div class="navbar__menu"> <a href="/">Home</a> <a href="https://github.com/eeromutka" target="_blank">GitHub</a> <button id="themeToggle" title="Theme Toggle" data-astro-cid-oemx5le4> <svg width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-astro-cid-oemx5le4> <path class="sun" fill-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1l-1.8 1.8a.8.8 0 0 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM6.3 17.7a.8.8 0 0 1 0 1l-1.7 1.8a.8.8 0 1 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1 0l1.8 1.8a.8.8 0 1 1-1 1L3.5 4.6a.8.8 0 0 1 0-1zm14.2 14.2a.8.8 0 0 1 1 0l1.8 1.7a.8.8 0 0 1-1 1l-1.8-1.7a.8.8 0 0 1 0-1z" data-astro-cid-oemx5le4></path> <path class="moon" fill-rule="evenodd" d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z" data-astro-cid-oemx5le4></path> </svg> </button>  <script>
    const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: light)').matches) {
            return 'light';
        }
        return 'dark';
    })();

    if (theme === 'dark') {
        document.documentElement.classList.remove('light');
    } else {
        document.documentElement.classList.add('light');
    }

    window.localStorage.setItem('theme', theme);

    const handleToggleClick = () => {
        const element = document.documentElement;
        element.classList.toggle("light");

        const isLight = element.classList.contains("light");
        localStorage.setItem("theme", isLight ? "light" : "dark");
    }

    document.getElementById("themeToggle").addEventListener("click", handleToggleClick);
</script> </div> </div> </nav> </header> <main>  <h2>Rug Racers: Ultimate</h2>  <p><span class="badge">C++</span>
<span class="badge">Raylib</span></p>
<p>Rug Racers: Ultimate is an arcade PvP racing game where you control an actual carpet. It was built during 10 weeks with a team of 6 students. I was the lead programmer and worked on gameplay, rendering, input, physics and tools.</p>
<p><a href="https://kuehldy.itch.io/rugracers">Link to the itch.io page</a></p>
<br>
<iframe allow="fullscreen;" width="100%" height="400" src="https://www.youtube.com/embed/_hasu6-OsI4" &#x22;=""></iframe>
<i>Physical setup and some competitive racing!</i><br><br>
<iframe allow="fullscreen;" width="100%" height="400" src="https://www.youtube.com/embed/e0APkjWyCWs" &#x22;=""></iframe>
<i>Gameplay recording. In this video, two young kids are playing the game for the first time.</i><br><br>
<h2>Introduction</h2>
<p><i>Rug Racers: Ultimate</i> began as an idea to take the punchy retro-arcade feel of old racing games such as <i>OutRun</i> and to put it on an actual carpet. Our first step was to study how to implement pseudo-3D rendering similar to OutRun. Instead of using an engine like Unity, we chose to hand-craft the engine on top of <a href="https://www.raylib.com/">raylib</a> for achieving the retro rendering feel.</p>
<p>There was one question: how would we design levels without an editor? I proposed using an image editing program as the level editor. By having a single image per entity-kind, we could put them on different layers and place entities by painting pixels into named layers. Each image would be a top-down map of all entities of a kind in the level. The brightness of a pixel controls the height of an entity, which allows for placing around clouds or birds or stacking buildings. I implemented level loading using stb_image with hotreloading to allow for easy iteration, as well as a hotreloading config-file system using cJSON which let us programmers expose tweakable variables for anyone on the team to edit. We knew that not using an engine like Unity was a risk and could put too much dependency on us programmers, so implementing these systems was crucial for the project's success.</p>
<br>
<img src="/rug_racers_data/multi-storey.png" style="width:100%;">
<h2>Rendering</h2>
<p>To render the world efficiently, a Z-sorted array of each sprite entity is built during level loading and a slice of that array is rendered each frame depending on the player's Z-coordinate. The entities all have 3D world coordinates that get perspective-projected into 2D and drawn back-to-front using raylib's 2D sprite drawing functions. Everything is drawn into a 320x360 rendertarget which is draw to the screen to emulate a lower-resolution screen. The curves in the level were a special effect done by translating the sprites horizontally according to a 1D "level curvature" texture. During playtesting, we got feedback that the sprites felt flickery. I extended raylib's sprite shader by adding <a href="https://www.shadertoy.com/view/ltBGWc">pixel art antialiasing</a>, which helped a lot.</p>
<h2>Physics</h2>
<p>The player physics are simple in essence, using just a 2D position and a velocity which gets continuously added into the position. I implemented pixel-perfect collision detection against sprites: if an artist drew a hole in a sprite, then a player could just fly through that hole without extra work. This is implemented by checking all sprites in the Z-sorted list that the player might cross through in a frame, doing an AABB check, and looping through the rectangular area of pixels that the player would collide with. If most of the pixels are opaque, the player dies and respawns. If some of the pixels are opaque, then an average "bounce" vector is found, and is applied to the player velocity along with a speed reduction, sound effect, dust particles and joycon rumble. If all pixels are transparent, we do nothing.</p>
<p>When a player is respawned after they die, they should spawn in an open / safe position and not in the middle of a stream of buildings. To do this, I keep track of the player's position history and spawn them where they were a few seconds ago. This player history turned out to be useful in other places too. I used it to implement the slipstream feature, which is a wind tunnel that a player leaves behind, giving the other player an easier time to catch up. I also used the history to record a flythrough of the map into a file, and made the main menu camera fly through the world using the recording. This made the main menu feel more energetic and inviting. We had Gotland Game Conference in mind when designing the game and wanted to attract a lot of attention from bystanders - just like a real arcade game would.</p>
<br>
<iframe allow="fullscreen;" width="100%" height="400" src="https://www.youtube.com/embed/-UrTNxstt6A" &#x22;=""></iframe>
<i>An unfortunate playtester hitting all the obstacles on the right</i><br><br>
<h2>Player Input</h2>
<p>The game idea was pitched and greenlit, but we hadn't yet discussed how to actually make a controllable carpet. As long as we had up/down/left/right inputs, we'd be happy. There were various ideas: distance-measuring strings attached to the carpet, joysticks underneath, taped wii controllers... We settled on Nintendo switch controllers and velcro tape thanks to their light and compact form. It was my task to figure out the rest.</p>
<p>A joycon has both an accelerometer and a gyroscope sensor. The accelerometer tracks acceleration in each axis, while the gyroscope tracks the angular momentum about each axis. The goal was to extract the absolute position of the controller (holding the carpet up should steer up, down to down, etc...). The proper way to find it would be to integrate the accelerometer data to get the velocity, and to integrate the velocity to get the position. However, small errors would make the position and velocity drift away from their true values quickly. The same issue applies to integrating absolute orientation using the gyroscope input.</p>
<p>After some experimentation with drift-reduction attempts, I realized that I could utilize the earth's gravity that shows up in the accelerometer data as a constant source of acceleration. It changes depending on how the controller is rotated / which axis the gravity is facing towards. This can be used for finding the absolute rotation! My solution was to take this estimate, apply smoothing to it to reduce noise from small accelerations, and add back some gyroscope input to get back some sharpness.</p>
<img src="/rug_racers_data/playtesting.jpg" style="width:100%;">
<i>Playtesting in action. In this version, we didn't have carpets yet and had two joycons per player. Only near the end, I scrapped this in favor of one joycon in the middle of a carpet which resulted in easier, more predictable controls.</i><br>
<h2>Other Fun Things</h2>
<p>There were lots of little fun polish features I worked on. For example, I made the particle system sprite player, the respawn screen transitions, camels and birds that bounce away when you hit them, and the interactive main menu where you lift the carpet up for "ready". But my favorite is the scoreboard and the carpet-controlled text editor for entering your name. You can see it in the first video at the top of the page <a href="https://youtu.be/_hasu6-OsI4?t=150">at 2:29</a>. This was the true challenge of the game to many players.</p>
<p>The game can be found at <a href="https://kuehldy.itch.io/rugracers">https://kuehldy.itch.io/rugracers</a>. You can play it on PC if you have two Nintendo Switch joycons and two fashionable carpets. A keyboard works too.</p>
<img src="/rug_racers_data/dab.jpg" style="width:100%;">
<i>A normal day at the office</i><br>
<br>
<img src="/rug_racers_data/RugRacersImage.jpg" style="width:100%;">
<i>Rug racing at the Gotland Game Conference</i><br>   <footer> <div class="center"> <ul class="footer"> <li class="icon__btn"><a class="icon__link" href="#" target="_blank"><span class="git-icon">GitHub</span></a></li> <li class="icon__btn"><a class="icon__link" href="mailto: #@gmail.com"><span class="mail-icon">Email</span></a></li> <li class="icon__btn"><a class="icon__link" href="#" target="_blank"><span class="linked-in">LinkedIn</span></a></li> </ul> <small>&copy; 2024 Milky-Way by <a class="footer__link" href="https://github.com/ttomczak3">ttomczak</a>. All Rights Reserved.</small> </div> </footer> </main>  </body> </html>