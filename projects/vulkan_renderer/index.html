<!DOCTYPE html><html lang="en" data-astro-transition-scope="astro-smooz4hq-1"> <head><meta charset="utf-8"><meta name="description" content="Astro description"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" href="https://fonts.googleapis.com/css2?family=Josefin+Sans&family=Pacifico&display=swap" as="style"><link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&family=Pacifico&display=swap" rel="stylesheet"><meta name="generator" content="Astro v4.16.7"><title>PBR renderer with real-time dynamic global illumination</title><style>#themeToggle[data-astro-cid-oemx5le4]{border:0;background:none}#themeToggle[data-astro-cid-oemx5le4]:hover{cursor:pointer;rotate:10deg}.moon[data-astro-cid-oemx5le4]{fill:#fdebf3}.sun[data-astro-cid-oemx5le4],.light .moon[data-astro-cid-oemx5le4]{fill:transparent}.light .sun[data-astro-cid-oemx5le4]{fill:#1e1e2e}@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0;mix-blend-mode:plus-lighter}to{opacity:1;mix-blend-mode:plus-lighter}}@keyframes astroFadeOut{0%{opacity:1;mix-blend-mode:plus-lighter}to{opacity:0;mix-blend-mode:plus-lighter}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
:root{--background: #1e1e2e;--background-light: #ffffff;--button: #78c2ad;--text: #fff7f7;--text-light: #2e2a1e;--text-link: #78c2ad;--underline: #375a7f;--header: "Cambria";--body: "Josefin Sans", sans-serif}html{background-color:var(--background);color:var(--text)}body{max-width:780px;margin:0 auto;text-align:justify}h1,h2{font-family:var(--header);font-weight:400}h1{font-size:2.6rem;margin:0 0 5px}h2{text-decoration:underline var(--underline);text-decoration-thickness:4px;text-underline-offset:7px;font-size:2.1rem;margin-bottom:0}p{font-family:var(--body);font-size:1.1rem;hyphens:None;line-height:1.5;text-indent:1rem}small,li{font-family:var(--body)}.navbar{display:grid;grid-template-columns:1fr 1fr;margin-top:.8rem}.navbar__title{font-family:var(--header);font-size:1.3rem}.navbar__menu{font-family:var(--body);font-size:1.1rem;text-align:right}.navbar__title>a,.navbar__menu>a{color:var(--text);text-decoration:none}.navbar__menu>a{margin:0 10px}.navbar__title>a:hover,.navbar__menu>a:hover,.navbar__menu>a:focus{text-decoration:underline var(--underline);text-decoration-thickness:2px;text-underline-offset:6px}.gif{margin:20px 0 0;text-align:center}.badge{background-color:#494b66;color:var(--text);border-radius:6px;font-family:var(--body);font-weight:600;font-size:.85rem;padding:.3em .6em .2em;margin-right:3px}.badge__list{text-indent:1rem;list-style:none;padding:0}.badge__list>li{margin-top:10px}.badge--item{border-radius:4px;font-size:.7rem;margin-right:5px;padding:.5em .3em .3em}.badge__link{color:var(--text-link);text-decoration:none}.badge__link:hover{text-decoration:underline}.card{list-style:none;display:flex;background-size:400%;padding:20px}.card__link{width:100%;text-decoration:none;line-height:1.4;border-radius:8px;color:var(--text)}.card__img{border-radius:5px}.card__title{margin:0;font-family:var(--body);font-size:1.5rem;font-weight:400;text-align:left}.card__txt{font-size:1rem;line-height:1.5;text-indent:0;text-align:left;margin:.5rem 0 0}.card__link:hover{transform:scale(1.05)}.link-card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(50ch,1fr));gap:1rem;padding:0}.btn{text-align:center;background:#0000;border:2px solid var(--button);border-radius:8px;color:var(--text);font:600 16px var(--body);padding:8px 16px;transition:background-color .4s,color .4s}.btn:hover{background-color:var(--button);color:var(--text-light);cursor:pointer}.skills{margin-top:8px}.skills__img{margin:8px 4px}.center{text-align:center}.pro-img{border-radius:16px;margin-top:10px}footer{margin:4rem 0}.footer__link{color:var(--text-link);text-decoration:none}.footer{cursor:default;list-style:none;padding:0}.icon__btn{display:inline-block;padding:0 .5rem}.icon__link{display:flex;padding:10px;height:20px;width:20px;border-radius:50%;border:2px solid #fdebf3}.icon__link:hover{border-color:var(--text-link)}.git-icon{content:url(/github-mark-white.svg)}.mail-icon{content:url(/mail-white.svg)}.linked-in{content:url(/li-in-white.png)}.lost{margin-top:30%;text-align:center}.lost__header{margin:0 auto;text-align:center;border:0;font-size:7.5rem;letter-spacing:10px}.lost__body{color:#5c5b77}.lost__link{color:var(--text-link);text-decoration:none}html.light{background-color:var(--background-light);color:var(--text-light)}.light .navbar__title>a{color:var(--text-light)}.light .navbar__menu>a{color:var(--text-light)}.light .card__title,.light .card__txt,.light .btn{color:var(--text-light)}.light .btn:hover{color:var(--text)}.light .icon__link{border:2px solid var(--text-light)}.light .icon__link:hover{border-color:var(--text-link)}.light .git-icon{content:url(/github-mark.svg)}.light .mail-icon{content:url(/mail.svg)}.light .linked-in{content:url(/li-in.png)}.light .badge__link{color:var(--text-link)}@media only screen and (max-width: 600px){body{width:350px}.navbar{display:initial}.navbar__title,.navbar__menu{text-align:center}.navbar__menu>a{margin:0 11px}.skills__img{height:30px;width:30px;margin:8px 1px}.badge__list{font-size:.9rem;text-indent:0}.pro-img{height:auto;width:350px}}
</style><script type="module">function e(){localStorage.theme==="light"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: light)").matches?document.documentElement.classList.add("light"):document.documentElement.classList.remove("light")}e();document.addEventListener("astro:after-swap",e);
</script><style>[data-astro-transition-scope="astro-smooz4hq-1"] { view-transition-name: astro-smooz4hq-1; }@layer astro { ::view-transition-old(astro-smooz4hq-1) { animation: none; opacity: 0; mix-blend-mode: normal; }::view-transition-new(astro-smooz4hq-1) { animation: none; mix-blend-mode: normal; }::view-transition-group(astro-smooz4hq-1) { animation: none } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-smooz4hq-1"] { animation: none; mix-blend-mode: normal; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-smooz4hq-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-smooz4hq-1"] { animation: none; mix-blend-mode: normal; }</style></head> <body> <header> <nav data-astro-transition-persist="astro-c3mo5b3h-2"> <div class="navbar"> <div class="navbar__title"></div> <div class="navbar__menu"> <a href="/">Home</a> <a href="https://github.com/eeromutka" target="_blank">GitHub</a> <button id="themeToggle" title="Theme Toggle" data-astro-cid-oemx5le4> <svg width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-astro-cid-oemx5le4> <path class="sun" fill-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1l-1.8 1.8a.8.8 0 0 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM6.3 17.7a.8.8 0 0 1 0 1l-1.7 1.8a.8.8 0 1 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1 0l1.8 1.8a.8.8 0 1 1-1 1L3.5 4.6a.8.8 0 0 1 0-1zm14.2 14.2a.8.8 0 0 1 1 0l1.8 1.7a.8.8 0 0 1-1 1l-1.8-1.7a.8.8 0 0 1 0-1z" data-astro-cid-oemx5le4></path> <path class="moon" fill-rule="evenodd" d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z" data-astro-cid-oemx5le4></path> </svg> </button>  <script>
    const theme = (() => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            return localStorage.getItem('theme');
        }
        if (window.matchMedia('(prefers-color-scheme: light)').matches) {
            return 'light';
        }
        return 'dark';
    })();

    if (theme === 'dark') {
        document.documentElement.classList.remove('light');
    } else {
        document.documentElement.classList.add('light');
    }

    window.localStorage.setItem('theme', theme);

    const handleToggleClick = () => {
        const element = document.documentElement;
        element.classList.toggle("light");

        const isLight = element.classList.contains("light");
        localStorage.setItem("theme", isLight ? "light" : "dark");
    }

    document.getElementById("themeToggle").addEventListener("click", handleToggleClick);
</script> </div> </div> </nav> </header> <main>  <h2>PBR renderer with real-time dynamic global illumination</h2>  <p><span class="badge">C++</span>
<span class="badge">Vulkan</span>
<span class="badge">GLSL</span></p>
<p>Renderer written in C++ and Vulkan to study modern physically-based rendering techniques and to experiment with a voxel-based global illumination technique.</p>
<p><a href="https://github.com/EeroMutka/Vulkan-PBR-Renderer">Link to the GitHub page</a></p>
<br>
<img src="/vulkan_renderer_data/bistro.jpg" style="width:100%;">
<i>A screenshot from the renderer using the <a href="https://developer.nvidia.com/orca/amazon-lumberyard-bistro">Amazon Lumberyard Bistro</a> scene</i><br>
<br>
<iframe allow="fullscreen;" width="100%" height="400" src="https://www.youtube.com/embed/DZkTVobNMT4" &#x22;=""></iframe>
<i>A video showcase of the renderer using the <a href="https://developer.nvidia.com/ue4-sun-temple">UE4 Sun Temple</a> scene</i><br>
<br>
<h2>About</h2>
<p>My goal for this project was to get more familiar with Vulkan and modern rendering techniques and to build a polished and pretty renderer. In the past, I had experimented with graphics and shader programming, but never really made anything polished, and I really wanted to put my learnings together.</p>
<p>After I got a triangle up and running, I started writing a graphics abstraction layer to make iteration and dealing with Vulkan easier. I continued to iterate on it as I started adding more features, such as texturing and 3D model loading. I researched physically based rendering techniques as I implemented simple physically based environment lighting. This was a big milestone!</p>
<img src="/vulkan_renderer_data/pbr_spheres.jpg" style="width:100%;">
<i>Physically based rendering with image-based lighting.</i>
<p>For loading textured fbx files, such as the sun temple, I started using <a href="https://github.com/assimp/assimp">Assimp</a> and <a href="https://github.com/redorav/ddspp">DDSPP</a>. For organizing the draw calls, I kept it simple and split the scene into N descriptor sets / draw calls, N being the number of materials in the FBX file. To give more power to the post-processing shaders, I added a G-buffer for the base-color, normal, occlusion-roughness-metallic and emissive channels. I added a directional sunlight that uses a 2048x2048 depth map for shadow mapping. I'm using a `samplerShadow` in GLSL for percentage-closer filtering and use 4 shadow map samples in a rotated-square pattern as I found it gives the nicest look.</p>
<p>I also implemented bloom, following the article <a href="https://learnopengl.com/Guest-Articles/2022/Phys.-Based-Bloom">Physically Based Bloom</a>. It's a sun temple after all! It was looking nice, but there were lots of bright pixels ("fireflies") here and there even after I added weighted averaging as suggested. My dumb solution was to limit the dynamic range of the first downsample pass using `value = min(value, vec3(1));`. From my testing, this gives a nicer result than the suggested methods.</p>
<iframe allow="fullscreen;" width="100%" height="400" src="https://www.youtube.com/embed/OwNb4dBba7Y" &#x22;=""></iframe>
<p>Lighting is important, and having indirect lighting can make a big difference. Unfortunately, computing indirect / global illumination efficiently and accurately is a difficult and open research problem. One common solution is lightmaps, but they don't work well with moving geometry. My idea was to voxelize the scene into a 3D texture (like in VXGI) each frame and marking each voxel with either a radiance value or a colored "wall" voxel (using the alpha channel to separate them), and to run a compute shader to flood light around it each frame. The light would then softly propagate from a light source (either a light-entity or an emissive surface), and slowly fade away in the distance creating areas of darkness. Typically with VXGI, a floor inside of a dark room might incorrectly catch light from the outside due to a cone trace going through walls. This wouldn't happen with my light flooding simulation idea as long as the wall is represented in the voxel texture.</p>
<p>First, I made an experiment in 2D:</p>
<iframe allow="fullscreen;" width="100%" height="400" src="https://www.youtube.com/embed/A5pfLBzvuzE" &#x22;=""></iframe>
<p>It was looking promising, so I took it to 3D:</p>
<img src="/vulkan_renderer_data/sponza_gi.jpg" style="width:100%;">
<p>It was noisy, but it was working! In the above pictures and the final demo, I'm using a resolution of 128x128x128 for the light grid which covers the entire world.</p>
<p>It then added the code into the main renderer. I made the voxelization shader calculate a direct lighting value using the sun depth buffer and write it into the light grid. This means that the spots where the sun hits are a source of light for the flooding stage. In the following image, you can see the light grid visualized by ray tracing into it. For rough reflections and ambient light, it can be useful to not trace all the way, but to accumulate light on the path as if it was fog. This reduces noise since there is less variation between the directions. You can see the "foggy" version on the bottom.</p>
<img src="/vulkan_renderer_data/light_grid.jpg" style="width:100%;">
<p>For sampling the light grid in the main pixel shader, my idea was to shoot screen-space rays and use the depth buffer for small-scale details, as the voxel light grid is very coarse and isn't enough to give good results. Using a low-frequency noise function for deciding sampling direction helps a lot, as well as temporal anti-aliasing. I ended up going with interleaved gradient noise thanks to its natural look. It's not perfect as it introduces some bias (e.g. see the dark spots on the wall in the middle of the image). As an extra optimization / noise reduction idea for the future, the rays could be sent in half or quarter resolution upscaled using an edge-aware blur.</p>
<img src="/vulkan_renderer_data/sampling.jpg" style="width:100%;">
<p>Implementing the ray sampling function that partly uses screen-space buffers and partly the 3D grid was tricky. Getting rid of light leaks and dark areas of over-occlusion was difficult to balance. Just relying on the depth-buffer is not enough to be confident to know when the ray hits a surface, because you can't know how deep some surface point in the depth buffer is. I use the 3D light grid to check for that, which helps. It's not perfect, but I'm still pretty happy with the overall result.</p>
<p>Throughout this process, a big help has been that I implemented shader hotreloading early on. It's so much easier to play around and try new things. Starting small in 2D and making my rendering experiments first in their own demos was also helpful. It made debugging and experimenting on those specific things easier, without worrying about all the other features that would be required in the full version. Overall, this project has taught me a lot about graphics programming and Vulkan and has been very fun to work on!</p>
<h2>Gallery</h2>
<br>
<img src="/vulkan_renderer_data/bistro1.jpg" style="width:100%;">
<img src="/vulkan_renderer_data/bistro3.jpg" style="width:100%;">
<img src="/vulkan_renderer_data/bistro2.jpg" style="width:100%;">
<img src="/vulkan_renderer_data/bistro4.jpg" style="width:100%;">
<i>The above screenshots are renderings of the exterior / interior versions of the <a href="https://developer.nvidia.com/orca/amazon-lumberyard-bistro">Amazon Lumberyard Bistro</a> scene.</i><br>   <footer> <div class="center"> <ul class="footer"> <li class="icon__btn"><a class="icon__link" href="https://github.com/eeromutka" target="_blank"><span class="git-icon">GitHub</span></a></li> <li class="icon__btn"><a class="icon__link" href="mailto: eero.mutka@gmail.com"><span class="mail-icon">Email</span></a></li> <li class="icon__btn"><a class="icon__link" href="https://www.linkedin.com/in/eero-mutka/" target="_blank"><span class="linked-in">LinkedIn</span></a></li> </ul> <small>&copy; 2024 Eero Mutka</small> </div> </footer> </main>  </body> </html>